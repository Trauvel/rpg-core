generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id           String        @id @default(cuid())
  email        String        @unique
  username     String        @unique
  password     String
  gameSessions GameSession[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model GameSession {
  id           String   @id @default(cuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  socketId     String?  // Socket ID текущего соединения
  isActive     Boolean  @default(true)
  characterName String?  // Имя персонажа в игре
  
  // Игровое состояние (все данные персонажа)
  level        Int      @default(1)
  experience   Int      @default(0)
  hp           Int      @default(10)
  maxHp        Int      @default(10)
  locationId   String?  // Текущая локация
  
  // Характеристики
  strength     Int      @default(10)
  dexterity    Int      @default(10)
  constitution Int      @default(10)
  intelligence Int      @default(10)
  wisdom       Int      @default(10)
  charisma     Int      @default(10)
  
  // Прочие данные
  class        String?  @default("Adventurer")
  race         String?  @default("Human")
  armorClass   Int      @default(10)
  initiative   Int      @default(0)
  speed        Int      @default(30)
  
  // Инвентарь (JSON массив)
  inventory    String   @default("[]")
  
  // Гибкие данные персонажа для будущей интеграции с D&D 5e SRD
  // Будет содержать: заклинания, черты, умения, экипировку и т.д.
  characterData String? // JSON строка для SQLite, позже будет Json/Jsonb в PostgreSQL
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([userId])
  @@index([isActive])
}

// Справочные данные из D&D 5e SRD
// Пока структура подготовлена для будущей загрузки данных
model DndClass {
  id          String   @id @default(cuid())
  name        String   @unique
  hitDie      Int      // Количество костей хитов (например, 8 для Fighter)
  description String?  // Описание класса
  subclasses  String   @default("[]") // JSON массив подклассов
  features    String?  // JSON объект с чертами класса
  spellcasting Boolean @default(false) // Может ли класс использовать заклинания
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([name])
}

model DndRace {
  id          String   @id @default(cuid())
  name        String   @unique
  description String?  // Описание расы
  subraces    String   @default("[]") // JSON массив подрас
  traits      String?  // JSON объект с чертами расы
  abilityScoreBonuses String? // JSON объект с бонусами к характеристикам
  speed       Int?     // Базовая скорость
  size        String?  // Размер (Small, Medium, Large)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([name])
}

// Сохранения игровых комнат
model RoomSnapshot {
  id          String   @id @default(cuid())
  roomCode    String
  masterId    String
  userId      String   // Создатель сохранения (обычно мастер)
  state       String   // JSON состояние игры
  gameStarted Boolean
  createdAt   DateTime @default(now())
  
  @@index([userId])
  @@index([roomCode])
}
